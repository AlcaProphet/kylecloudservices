<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>R2 File Manager</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
</head>
<body>
  <div class="container mt-4">
    <h1 class="mb-4">R2 File Manager</h1>
    <div id="file-list" class="list-group">
      <!-- File list will be populated here -->
    </div>
  </div>

  <script>
    // Function to fetch and display files
    async function fetchFiles() {
      try {
        const response = await fetch("https://drivequerylist.kylecloudservices.com", {
          method: "GET",
          headers: {
            "Access-Control-Allow-Origin": "*", // CORS header
          },
        });
        
        if (!response.ok) {
          throw new Error("Failed to fetch files");
        }

        const files = await response.json();

        const fileList = document.getElementById("file-list");
        fileList.innerHTML = ""; // Clear existing items

        files.forEach((file) => {
          const fileItem = document.createElement("div");
          fileItem.className = "list-group-item d-flex justify-content-between align-items-center";

          fileItem.innerHTML = `
            <div>
              <strong>${file.key}</strong>
              <small class="text-muted ms-3">Size: ${file.size} bytes</small>
            </div>
            <div>
              <a href="https://your-r2-bucket-url/${file.key}" class="btn btn-primary btn-sm" target="_blank">Download</a>
              <button class="btn btn-danger btn-sm ms-2" onclick="deleteFile('${file.key}')">Delete</button>
            </div>
          `;
          fileList.appendChild(fileItem);
        });
      } catch (error) {
        console.error("Error fetching files:", error);
      }
    }

    // Function to delete a file
    async function deleteFile(key) {
      if (confirm(`Are you sure you want to delete "${key}"?`)) {
        try {
          const response = await fetch(`https://your-worker-url/${key}`, {
            method: "DELETE",
            headers: {
              "Access-Control-Allow-Origin": "*", // CORS header
            },
          });

          if (response.ok) {
            alert("File deleted successfully");
            fetchFiles(); // Refresh file list
          } else {
            throw new Error("Failed to delete file");
          }
        } catch (error) {
          console.error("Error deleting file:", error);
          alert("Failed to delete the file.");
        }
      }
    }

    // Fetch files on page load
    document.addEventListener("DOMContentLoaded", fetchFiles);
  </script>
</body>
</html>
